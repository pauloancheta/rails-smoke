#!/usr/bin/env ruby
# frozen_string_literal: true

require "rails_smoke"

if ARGV[0] == "init"
  initializer = RailsSmoke::Initializer.new
  initializer.run
  exit 0
end

unless system("git rev-parse --is-inside-work-tree > /dev/null 2>&1")
  warn "Error: must be run inside a git repository"
  exit 1
end

begin
  config = RailsSmoke::Config.new
  runner = RailsSmoke::Runner.new(config: config)
  runner.run

  unless runner.success?
    warn "FAILED: after tests did not pass"
    exit 1
  end
rescue RailsSmoke::Error => e
  warn "Error: #{e.message}"
  exit 1
end
